<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, width=device-width" />

  <link rel="stylesheet" href="{{ url_for('static', filename='login_global.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='login.css') }}" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Plus Jakarta Sans:wght@400;500;600&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap" />
  <style>
    /* The Modal (background) */
    .modal {
      display: none;
      /* Hidden by default */
      position: fixed;
      /* Stay in place */
      z-index: 1;
      /* Sit on top */
      left: 0;
      top: 0;
      width: 100%;
      /* Full width */
      height: 100%;
      /* Full height */
      overflow: auto;
      /* Enable scroll if needed */
      background-color: rgb(0, 0, 0);
      /* Fallback color */
      background-color: rgba(0, 0, 0, 0.4);
      /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      /* 15% from the top and centered */
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      /* Could be more or less, depending on screen size */
    }

    /* The Close Button */
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <div class="buttonless">
    <div class="content">
      <img class="content-child" loading="lazy" alt="" src="{{ url_for('static', filename='./public/group-2.svg') }}" />

      <div class="app-description">
        <div class="bg"></div>
        <div class="app-name">
          <h1 class="adovelopers">AdoVelopers</h1>
          <div class="the-best-fingerprint">The best fingerprint locked door.</div>
        </div>
        <button class="read-more">
          <a class="read-more1">Read More</a>
        </button>
      </div>
    </div>
    <img class="billboard-2-icon" alt="" src="{{ url_for('static', filename='./public/billboard-2@2x.png') }}" />
    <img class="pngwing-1-icon" alt="" src="{{ url_for('static', filename='./public/pngwing-1@2x.png') }}" />

    <div class="logo-name">LOGO NAME</div>
    <div class="login">
      <div class="login-form-container">
        <form id="login-form" class="login-options">
          <div class="fingerprint-login">
            <img class="group-icon" loading="lazy" alt=""
              src="{{ url_for('static', filename='./public/group-1.svg') }}" />
          </div>
          <div class="login-instructions">
            <div class="login-instruction-parent">
              <div class="login-instruction">
                <h3 class="log-in-to">Log in to your Account</h3>
              </div>
              <div class="place-your-registered">Place your registered fingerprint on the sensor.</div>
            </div>
          </div>
          <div class="social-login">
            <div class="continue-with-google">
              <div class="google-login-icon">
                <img class="group-icon1" loading="lazy" alt=""
                  src="{{ url_for('static', filename='./public/group-1.svg') }}" />
              </div>
              <img class="icon" alt="" src="{{ url_for('static', filename='./public/icon.svg') }}" />
              <div class="continue-with-touch">Continue with Touch ID</div>
            </div>
            <div class="email-login">
              <div class="email-input">
                <div class="email-input-container">
                  <div class="email-address-container">
                    <div class="email-address-input">
                      <div class="email-address-input-inner">
                        <div class="frame-child"></div>
                      </div>
                      <div class="or">OR</div>
                      <div class="email-address-input-child">
                        <div class="frame-item"></div>
                      </div>
                    </div>
                  </div>
                  <div class="email-address">Email Address</div>
                </div>
              </div>
              <div class="email-value">
                <div class="field"></div>
                <input id="email" class="johndoegmailcom" placeholder="johndoe@gmail.com" type="text" />
                <small id="email-error" style="color:red; display:none;">Please enter a valid email address.</small>
              </div>
            </div>

            <div class="password-input">
              <div class="password-input-container">
                <div class="password">Password</div>
              </div>
              <div class="password-value">
                <div class="field1"></div>
                <div class="password-dots">
                  <input id="password" class="input" placeholder="•••••••••••" type="password" />
                  <div class="password-visibility">
                    <!-- Show eye (hidden password) -->
                    <img id="eye-icon" class="eye-icon" alt="Show Password"
                      src="{{ url_for('static', filename='./public/eye.svg') }}" onclick="togglePasswordVisibility()" />
                    <!-- Hide eye (visible password), hidden by default -->
                    <img id="eye-disabled-icon" class="eye-disabled-icon" alt="Hide Password"
                      src="{{ url_for('static', filename='./public/eyes.svg') }}" onclick="togglePasswordVisibility()"
                      style="display: none;" />
                  </div>
                </div>
              </div>
            </div>

            <div class="remember-forgot-password">
              <div class="remember-password">
                <div class="remember-me-checkbox">
                  <input id="remember-me" class="checkbox" type="checkbox" />
                </div>
                <div class="remember-me">Remember me</div>
              </div>
              <div class="forgot-password">Forgot Password?</div>
            </div>

            <button type="submit" class="log-in">
              <img class="icon1" alt="" src="{{ url_for('static', filename='./public/icon.svg') }}" />
              <div class="button">Log in</div>
            </button>
        </form>

        <div class="signup">
          <div class="signup-prompt">
            <div class="dont-have-an">Don’t have an account?</div>
            <div class="sign-up">Sign Up</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal HTML -->
  <div id="welcomeModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <p id="welcomeMessage"></p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    async function checkFingerprint() {
      try {
        const response = await fetch('/login/fingerprint', {
          method: 'POST', // Changed to POST
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ /* any data you might need */ })
        });

        const data = await response.json();

        if (data.message === 'Login successful') {
          document.getElementById('status').innerText = "Fingerprint Verified!";
          // Show the modal with the user's name
          showModal(data.full_name);
          clearInterval(polling);
          // Redirect or take another action after success
          window.location.href = "/dashboard";  // Example redirect
        } else {
          document.getElementById('status').innerText = "Waiting for fingerprint verification...";
        }
      } catch (error) {
        console.error("Error checking fingerprint status:", error);
      }
    }

    // Polling for fingerprint verification status
    const polling = setInterval(checkFingerprint, 5000); // Adjust interval as needed

    function togglePasswordVisibility() {
      const passwordField = document.getElementById('password');
      const eyeIcon = document.getElementById('eye-icon');
      const eyeDisabledIcon = document.getElementById('eye-disabled-icon');

      if (passwordField.type === "password") {
        passwordField.type = "text";
        eyeIcon.style.display = 'none';
        eyeDisabledIcon.style.display = 'block';
      } else {
        passwordField.type = "password";
        eyeIcon.style.display = 'block';
        eyeDisabledIcon.style.display = 'none';
      }
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(String(email).toLowerCase());
    }

    function showModal(userName) {
      const modal = document.getElementById('welcomeModal');
      const welcomeMessage = document.getElementById('welcomeMessage');
      const span = document.getElementsByClassName('close')[0];

      welcomeMessage.innerText = `Welcome to Mobile Legends ${userName}`;
      modal.style.display = 'block';

      setTimeout(function () {
        modal.style.display = 'none';
      }, 5000);

      span.onclick = function () {
        modal.style.display = 'none';
      }

      window.onclick = function (event) {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      }
    }

    document.getElementById('login-form').addEventListener('submit', function (event) {
      event.preventDefault(); // Prevent the default form submission

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const rememberMe = document.getElementById('remember-me').checked;

      if (!validateEmail(email)) {
        document.getElementById('email-error').style.display = 'block';
        return;
      } else {
        document.getElementById('email-error').style.display = 'none';
      }

      if (!email || !password) {
        alert("Email and Password are required.");
        return;
      }

      const data = {
        email: email,
        password: password,
        rememberMe: rememberMe
      };

      axios.post('/logging_in', data)
        .then(function (response) {
          if (response.data.message === 'SUCCESS') {
            alert("Login successful");
            window.location.href = '/register';
          } else {
            alert("Login failed: " + response.data.message);
          }
        })
        .catch(function (error) {
          console.error('Error:', error);
        });
    });
  </script>
</body>

</html>